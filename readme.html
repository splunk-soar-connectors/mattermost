<!-- File: readme.html
  Copyright (c) 2018 Splunk Inc.

  SPLUNK CONFIDENTIAL â€“ Use or disclosure of this material in whole or in part
  without a valid written license from Splunk Inc. is PROHIBITED.
-->

<html>
<head>
</head>
<body>
<h2>Authentication</h2>
This app supports two types of authentication
<ul>
    <li>Personal access token</li>
    <li>Oauth 2.0 authentication</li>
</ul>
<h3>Personal access token</h3>
<b><u><i>NOTE:</i></u></b> To use this method user should have been given <b>&quotAllow this account to generate personal access tokens&quot</b> permission by system admin.
<br>To use this method, follow the steps below.
<ol>
    <li>Login to Mattermost server with user credentials in a browser.</li>
    <li>In the upper left corner of window, click on username, then click <b>Account Settings</b>.</li>
    <li>Select <b>Security</b> and click on <b>Personal Access Tokens</b>.</li>
    <li>Click on <b>Create New Token</b> and provide a description for your token.</li>
    <li>A pair of <b>Token ID</b> and <b>Token</b> would be generated.</li>
    <li>Copy the <b>Token</b> and save it at someplace safe as you will not be able to see the token again.</li>
</ol>
Provide the token generated by performing above steps in the <b>personal_token</b> field in asset configuration. Click save and run test connectivity.
<h3>Oauth 2.0 authentication</h3>
<b><u><i>NOTE:</i></u></b> To use this method, System Admin should set <b>Enable OAuth 2.0 Service Provider</b> option to &quottrue&quot.
<br>System Admin should register the app on Mattermost using the steps given below:
<ol>
    <li>Login to Mattermost server with admin credentials in a browser.</li>
    <li>In the upper left corner of window, click on username, then click <b>Integrations</b>.</li>
    <li>Select <b>OAuth 2.0 Applications</b> and click on <b>Add OAuth 2.0 Application</b>.</li>
    <li>Set &quotIs Trusted&quot to <b>true</b>.</li>
    <li>Provide any display name to your application and give a description.</li>
    <li>Provide any valid URL as Homepage URL.</li>
    <li>For now provide any valid URL as Callback URL. Phantom redirect URL would be generated after creating asset with client ID and client secret. We will update that URL here.</li>
    <li>Click on Save.</li>
    <li>A pair of <b>Client ID</b> and <b>Client Secret</b> would be generated. Save it somewhere securely.</li>
</ol>
<br>
While creating the asset for this authentication method, provide Client ID and Client Secret generated during previous steps in <b>client_id</b> and <b>client_secret</b> field of asset configuration and click on Save.
<br>
New field called <b>POST incoming for Mattermost to this location</b> will appear in the <b>Asset Settings</b> tab. Take the URL found in this field and place it in the <b>Callback URL</b> field of your registered app on Mattermost server. To this URL, add <b>/result</b> at the end. After doing so the URL should look something like:
<pre>
https://&lt;phantom_host&gt;/rest/handler/mattermost_b303c16b-8b45-404d-b573-dd5f4b0082e0/&lt;asset_name&gt;/result
</pre>
Once again, click save.
<br>
<h2>Note</h2>
<b>A new client secret would be generated after updating Callback URL in Mattermost. Update that client secret on the asset created on Phantom</b>.

<h2>Method to run test connectivity</h2>
For Personal token method of authentication you just need to click the <b>TEST CONNECTIVITY</b> button.
<br>
For Oauth 2.0 authentication method, Click on <b>TEST CONNECTIVITY</b> button, a window will pop up and display a URL. Navigate to this URL in a separate browser tab. This new tab will redirect to Mattermost login page. Log in using your username and password. After logging in, click <b>Authorize</b> button. Finally close that tab. The test connectivity window should show success message.

<h2>Note</h2>
<ul>
    <li>All the asset configuration parameters are optional, but you need to provide the configuration parameters based on the authentication method you want to use. Otherwise the actions will return an error.</li>
    <li>Once you run test connectivity using <b>Oauth 2.0 authentication</b> method, all the actions other than test connectivity will pass for that asset, even if you remove the configuration parameters after running test connectivity.</li>
    <li>If you have provided all the configuration parameters, the priority of the authentication method is as follows:
        <ol>
            <li>Personal access token</li>
            <li>Oauth 2.0 access token</li>
        </ol>
    </li>
</ul>

<h2>Note</h2>
<ul>
    <li>If the personal token of the user is revoked by system admin, user needs to contact system admin and generate new token.</li>
    <li>For Oauth 2.0, the access token is valid up to 30 days/720 hours. After that user will need to run test connectivity again for authentication.</li>
</ul>
</body>
</html>